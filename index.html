<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>帯屋町筋クイズ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="start-screen" class="screen active">
        <h1>帯屋町筋クイズに挑戦！</h1>
        <p>ポスターにある5つのクイズから、挑戦したいクイズを一つ選んでください！</p>
        <div id="quiz-selection-buttons">
            </div>
    </div>

    <div id="quiz-screen" class="screen">
        <h2 id="quiz-title"></h2>
        <p id="question-text"></p>
        
        <div id="audio-container" style="display: none; margin: 20px 0;">
            <audio id="quiz-audio" controls></audio>
        </div>

        <div id="options-container">
            </div>
    </div>

    <div id="result-screen" class="screen">
        <h2 id="result-message"></h2>
        <p>お疲れ様でした！</p>
        <button id="restart-button">別のクイズに挑戦する</button>
    </div>

    <script src="quiz.js"></script>
    <script>
        // DOM要素の取得
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');
        const selectionButtonsContainer = document.getElementById('quiz-selection-buttons');
        const restartButton = document.getElementById('restart-button');

        // 画面切り替え関数
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // 選択ボタンの初期表示
        function renderSelectionButtons() {
            selectionButtonsContainer.innerHTML = ''; // ボタンをクリア
            QUIZ_DATA.forEach(quiz => {
                const button = document.createElement('button');
                button.textContent = quiz.title;
                button.classList.add('select-button');
                button.onclick = () => startQuiz(quiz.id);
                selectionButtonsContainer.appendChild(button);
            });
            showScreen('start-screen');
        }

        // クイズ開始
        function startQuiz(quizId) {
            selectedQuiz = QUIZ_DATA.find(q => q.id === quizId);

            if (!selectedQuiz) return;

            // クイズ画面の要素を更新
            document.getElementById('quiz-title').textContent = selectedQuiz.title;
            document.getElementById('question-text').textContent = selectedQuiz.question;
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = ''; // 選択肢をクリア

            // 音声問題の対応
            const audioContainer = document.getElementById('audio-container');
            const quizAudio = document.getElementById('quiz-audio');
            
            if (selectedQuiz.type === 'audio' && selectedQuiz.audio_src) {
                audioContainer.style.display = 'block';
                quizAudio.src = selectedQuiz.audio_src;
                quizAudio.load(); // 音声ファイルをロード
            } else {
                audioContainer.style.display = 'none';
                quizAudio.src = '';
            }

            // 選択肢ボタンの生成
            selectedQuiz.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('option-button');
                button.onclick = () => checkAnswer(option);
                optionsContainer.appendChild(button);
            });

            showScreen('quiz-screen');
        }

        // 回答判定
        function checkAnswer(selectedOption) {
            const isCorrect = (selectedOption === selectedQuiz.answer);
            const messageElement = document.getElementById('result-message');

            if (isCorrect) {
                messageElement.textContent = '🎉 正解です！帯屋町マニア！';
                messageElement.style.color = 'green';
            } else {
                messageElement.textContent = '残念！もう一度挑戦してみましょう...';
                messageElement.style.color = 'red';
            }

            // 最終結果画面に遷移
            showScreen('result-screen');
        }

        // リスタート（選択画面へ戻る）ボタンの設定
        restartButton.onclick = renderSelectionButtons;

        // 初期化処理
        document.addEventListener('DOMContentLoaded', renderSelectionButtons);
    </script>
</body>
</html>